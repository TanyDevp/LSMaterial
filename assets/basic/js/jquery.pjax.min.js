(function(k,r){var d={selector:"a",container:"body",cache:!0,hash:!1,same:!0,debug:!1,filter:{selector:null,content:null},custom:{append:null},events:null},m=history.pushState?2:"onhashchange"in k?1:0,h={extend:function(a,b){if(b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c]);return a}},log:function(a){d.debug&&console.log("coffce-pjax: "+a)},getPath:function(a){return a.replace(location.protocol+"//"+location.host,"")},getFullHref:function(a){var b=document.createElement("a");b.href=a;return b.href},
matchSelector:function(a,b){var c=document.documentElement.webkitMatchesSelector||document.documentElement.mozMatchesSelector||document.documentElement.msMatchesSelector||function(a,b){if(b.tagName===a.toUpperCase())return!0;a=document.querySelectorAll(a);for(b=a.length;b--;)if(a[b]===this)return!0;return!1};h.matchSelector=function(a,b){return c.call(a,b)};return h.matchSelector(a,b)}},p={key:function(a){return"coffce-pjax["+a+"]"},get:function(a){return(a=sessionStorage.getItem(p.key(a)))&&JSON.parse(a)},
set:function(a,b){try{sessionStorage.setItem(p.key(a),JSON.stringify(b))}catch(c){h.log("\u8d85\u51fa\u672c\u5730\u5b58\u50a8\u5bb9\u91cf\u4e0a\u7ebf\uff0c\u672c\u6b21\u64cd\u4f5c\u5c06\u4e0d\u4f7f\u7528\u672c\u5730\u7f13\u5b58")}},clear:function(){for(var a=sessionStorage.length;a--;){var b=sessionStorage.key(a);-1<b.indexOf("coffce-pjax")&&sessionStorage.removeItem(b)}}},e={popstate:function(){g.fnb=!0;g.turn(location.href,null,null)},hashchange:function(){g.fnb&&g.turn(location.href.replace("#/",
""),null,null)},click:function(a){var b=a.target||a.srcElement;if(h.matchSelector(b,d.selector)&&(!d.filter.selector||d.filter.selector(b))){var c=b.getAttribute("data-coffce-pjax-href"),c=c?h.getFullHref(c):b.href;void 0!==c&&""!==c&&(a.preventDefault?a.preventDefault():k.event.returnValue=!1,d.same||c!==location.href)&&(a=b.getAttribute("data-coffce-pjax"),g.fnb=!1,g.turn(c,a,null))}},bindEvent:function(){2===m?(k.addEventListener("popstate",e.popstate),k.addEventListener("click",e.click)):(k.attachEvent("onhashchange",
e.hashchange),document.documentElement.attachEvent("onclick",e.click))},unbindEvent:function(){2===m?(k.removeEventListener("popstate",e.popstate),k.removeEventListener("click",e.click)):(k.detachEvent("onhashchange",e.hashchange),document.documentElement.detachEvent("onclick",e.click))}},g={fnb:!1,show:function(a,b,c){f.trigger("end");document.title=b;d.custom.append?d.custom.append(c,d.container):d.container.innerHTML=c;-1<a.indexOf("main")?$.getScript("assets/js/main.js"):$.getScript(a.replace("pages/",
"assets/js/").replace(".html",".js"));f.trigger("init")},turn:function(a,b,c){var n={url:a,fnb:g.fnb,data:b},e=a.substring(a.indexOf(location.host)+location.host.length).replace("#","pages");if(0<a.indexOf("#/"))a=-1<a.indexOf("?")?e.replace("?",".html?"):e+".html";else if("/"==e||"/pages"==e)a="/pages/main.html";if(g.fnb&&d.cache&&(e=p.get(a),null!==e)){g.show(a,e.title,e.html);return}var l=new XMLHttpRequest;l.open("GET",a,!0);l.setRequestHeader("COFFCE-PJAX","true");l.setRequestHeader("X-Requested-With",
"XMLHttpRequest");n.xhr=l;f.trigger("ajaxBegin",n);l.onreadystatechange=function(){if(4===l.readyState){if(200<=l.status&&300>l.status||304===l.status){var e=l.getResponseHeader("COFFCE-PJAX-TITLE")||document.title,k=l.responseText;if(d.filter.content&&!d.filter.content(e,k))h.log("filter.content\u8fc7\u6ee4\u4e0d\u901a\u8fc7");else if(c&&c(b),f.trigger("ajaxSuccess",n),g.show(a,e,k),!g.fnb){if(2===m){var q=a.replace("pages/","#/").replace(".html","");-1<a.indexOf("main")&&(q="/");history.pushState(null,
null,q)}else location.hash=h.getPath(a);d.cache&&p.set(a,{title:e,html:k})}}else f.trigger("ajaxError",null,n),h.log("\u8bf7\u6c42\u5931\u8d25\uff0c\u9519\u8bef\u7801\uff1a"+l.status);g.fnb=!0}};l.send()}},f={ready:!1,events:{},init:function(a){if(0===m)h.log("\u4e0d\u652f\u6301\u8be5\u7248\u672c\u7684\u6d4f\u89c8\u5668");else{h.extend(d,a);if("string"===typeof d.container&&(a=d.container,d.container=document.querySelector(d.container),null===d.container))throw Error("\u627e\u4e0d\u5230Element\uff1a"+
a);if(d.events)for(var b in d.events)f.on(b,null,d.events[b]);1===m&&2<location.hash.length&&(d.container.innerHTML="",f.ready=!0,g.fnd=!1,g.turn(location.href.replace("#/",""),null,function(){f.trigger("init")}));e.bindEvent();f.ready||(f.ready=!0,f.trigger("init"))}},destroy:function(){f.events=null;e.unbindEvent();h.clearCache()},turn:function(a,b,c){a=h.getFullHref(a);g.fnb=!1;g.turn(a,b,c)},on:function(a,b,c){void 0===c?(c=b,b=null):b&&(b=h.getFullHref(b));f.events[a]=f.events[a]||[];f.events[a].push({listener:c,
url:b})},off:function(a,b){if(b){var c=f.events[a];b=h.getFullHref(b);for(var d=0;d<c.length;d++)c[d].url===b&&(c.splice(d,1),d--);if(c.length)return}delete f.events[a]},trigger:function(a,b){if(a=f.events[a])for(var c=0,d=a.length;c<d;c++)a[c].listener.call(f,b)}};"function"===typeof define&&define.amd?define([],function(){return f}):"object"===typeof module&&"object"===typeof exports?module.exports=f:k.CoffcePJAX=f})(window);